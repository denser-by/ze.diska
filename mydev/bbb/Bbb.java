package mydev.bbb; import java.awt.BorderLayout; import java.awt.Button; import java.awt.Checkbox; import java.awt.Color; import java.awt.Event; import java.awt.FlowLayout; import java.awt.Font; import java.awt.Frame; import java.awt.Graphics; import java.awt.Image; import java.awt.Panel; import java.awt.Point; import java.awt.TextField; import mydev.aaa.Aaa; import mydev.aaa.Kadr; import mydev.aaa.Longy; import mydev.aaa.Shorty; import mydev.aaa.Sleeper; import mydev.aaa.Slip; import mydev.aaa.Stop; import mydev.about.Canvas; import mydev.about.ColorsArray; import mydev.about.Paint; import mydev.about.Point2D; import mydev.about.Rectangle2D; import mydev.about.Text2D; import mydev.uix.Better; import mydev.uix.External3DPanel; import mydev.uix.Props; import mydev.uix.Timer; import mydev.vutils.Spiska; public class Bbb extends Frame implements Runnable,Stop,Kadr { final short fin=18; BOkno f1,f2,f3,f4,r; Shorty rt=Enter2.instance().shorty(); Longy lg; BSometime som; boolean autoEnabled=false; InternalPlane oknosPlane; BbbRightPanel topPanel; ToolbarLeftPanel leftPanel; protected Aaa app; short[] w={ 0,230,240,250,260,199}; short[] h={ 0,170,160,140,130,155}; short[] x={ 0,31,311,635,924,rt.rev2(rt.rev(1366,w[5]),2)}; short[] y={ 0,19,500,150,300,rt.rev2(rt.rev(768,h[5]),2)}; public Bbb() { super("BbbAaa"); this.som=Enter2.instance().sometime(); this.lg=Enter2.instance().longy();} void prepare() { setLayout(new BorderLayout()); setBackground(Color.white); add("East",topPanel=new BbbRightPanel()); add("Center",oknosPlane=new InternalPlane(Color.gray,Color.lightGray)); add("West",leftPanel=new ToolbarLeftPanel());} public static void main(String[] args) { Bbb main=new Bbb(); System.out.print("HelloWindWorld"); main.prepare(); main.resize((short)(800 *(1.f+1.f-.4f+.15f-.06f+0.044f-.0056f+.0017f)),(short)(600 * 1.1953f)); main.show(); main.reMoveRnd(); main.start(); System.out.println("main!"); Sleeper sleeper=new Sleeper(); while(Better.working) { main.refreshUpdatable(); sleeper.sleep(Timer.DEF_REF_TIME);} main.ka(); main.hide(); main.dispose(); System.exit(1-1);} public boolean handleEvent(Event et) { if(et.id==Event.WINDOW_DESTROY) new Better().exitApplicationLoop(); if(et.id==Event.ACTION_EVENT && et.target==leftPanel.btAuto) auto(); if(et.id==Event.ACTION_EVENT && et.target==leftPanel.getCbExt()) extInternal(leftPanel.getExternal()); if(et.id==Event.ACTION_EVENT && et.target==leftPanel.getDefBtnPanel().getBtRepo()) reposition(leftPanel.getExternal()); if(et.id==Event.ACTION_EVENT && et.target==topPanel.getBtStop()) topPanel.disableStop(); if(et.id==Event.ACTION_EVENT && et.target==leftPanel.getDefBtnPanel().getBtDef()) reset(leftPanel.getExternal()); return super.handleEvent(et);} public void start() { reloadInternal();} private void extInternal(boolean ext) { hideAllWindows(); if(ext) reloadExternal(); else reloadInternal();} private void hideAllWindows() { ka();} private void reloadInternal() { som.start(); Bbb pi=(Bbb) this;(f1=Enter2.instance().okno(oknosPlane)).size(w[1],h[1]).move(x[1],y[1]).kadr(new BbbClOknoViewKadr(f1,pi)).show(pi,"aa1");(f2=Enter2.instance().okno(oknosPlane)).size(w[2],h[2]).move(x[2],y[2]).kadr(new BbbClOknoViewKadr(f2,pi)).show(pi,"aa2");(f3=Enter2.instance().okno(oknosPlane)).size(w[3],h[3]).move(x[3],y[3]).kadr(new BbbClOknoViewKadr(f3,pi)).show(pi,"aa3");(f4=Enter2.instance().okno(oknosPlane)).size(w[4],h[4]).move(x[4],y[4]).kadr(new BbbClOknoViewKadr(f4,pi)).show(pi,"aa4");(r=Enter2.instance().okno(oknosPlane)).size(w[5],h[5]).move(x[5],y[5]).kadr(new BbbClOknoViewKadr(r,new BExperiment(r))).show(pi,"aaa");} private void reloadExternal() { app=new Aaa(); app.entrypoint();} private void reset(boolean ext) { if(ext) { hideAllWindows(); reloadInternal();} f1.size(w[1],h[1]).move(x[1],y[1]); f2.size(w[2],h[2]).move(x[2],y[2]); f3.size(w[3],h[3]).move(x[3],y[3]); f4.size(w[4],h[4]).move(x[4],y[4]); r.size(w[5],h[5]).move(x[5],y[5]); extInternal(leftPanel.getExternal()); oknosPlane.performRepaint();} private void reposition(boolean ext) { if(ext) repositionExternal(); else repositionInternal(); extInternal(leftPanel.getExternal()); oknosPlane.performRepaint();} private void repositionInternal() { Location ol=Enter2.instance().location(); short mw=10; short mh=10; for(int i=0; i < w.length; i++) { if(mw < w[i]) mw=w[i]; if(mh < h[i]) mh=h[i];} Point p=ol.getRandomInternalPos(mw,mh); f1.move((short) p.x,(short) p.y); p=ol.getRandomInternalPos(mw,mh); f2.move((short) p.x,(short) p.y); p=ol.getRandomInternalPos(mw,mh); f3.move((short) p.x,(short) p.y); p=ol.getRandomInternalPos(mw,mh); f4.move((short) p.x,(short) p.y); p=ol.getRandomInternalPos(mw,mh); r.move((short) p.x,(short) p.y);} private void repositionExternal() { hideAllWindows(); reloadInternal(); Location ol=Enter2.instance().location(); short mw=10; short mh=10; for(int i=0; i < w.length; i++) { if(mw < w[i]) mw=w[i]; if(mh < h[i]) mh=h[i];} Point p=ol.getRandomExternalPos(mw,mh); f1.move((short) p.x,(short) p.y); p=ol.getRandomExternalPos(mw,mh); f2.move((short) p.x,(short) p.y); p=ol.getRandomExternalPos(mw,mh); f3.move((short) p.x,(short) p.y); p=ol.getRandomExternalPos(mw,mh); f4.move((short) p.x,(short) p.y); p=ol.getRandomExternalPos(mw,mh); r.move((short) p.x,(short) p.y); hideAllWindows(); reloadExternal();} public void run() { topPanel.enableStop(); Sleeper sleeper=new Sleeper(); int i; for(i=0; topPanel.hasLongTermContin() && i < fin; i++) { topPanel.setProgText(""+(fin-i)); reposition(false); sleeper.sleep(1997 * 2);} if(topPanel.hasLongTermContin()) { topPanel.setProgText(""+(fin-i)); reset(false); sleeper.sleep(1997 * 2);} if(topPanel.getPreview() && topPanel.hasLongTermContin()) new Better().exitApplicationLoop(); leftPanel.enableCtrls(true); topPanel.disableStop(); topPanel.setProgText("");} private void auto() { leftPanel.enableCtrls(false); new Thread(this).start();} private void refreshUpdatable() { if(oknosPlane.checkRepaint()) oknosPlane.performRepaint();} protected void reMoveRnd() { Location ol=Enter2.instance().location(); Point p=ol.getRandomExternalPos((short) 1024,(short) 768); move(p.x,p.y);} public void ka() { if(app !=null) { app.ka(); app=null;} else Enter2.instance().slipstream().push(f1.finish()).push(f2.finish()).push(f3.finish()).push(f4.finish()).push(r.finish()); oknosPlane.clearBOknos(); oknosPlane.performRepaint(); som.stop();} public void make(Graphics cs1,short mx,short my) { Canvas ics=new Canvas(cs1); Paint pn=new Paint(); Rectangle2D bg=new Rectangle2D(new Point2D(0,0),mx,my,ColorsArray.orangePoint.ic(),true); bg.toPen(ics,pn.select(bg)); Rectangle2D border=new Rectangle2D(new Point2D(0,0),mx,my,ColorsArray.magentaPoint.ic()); border.toPen(ics,pn.select(border)); String met=""+lg.ext(som.rlong(),System.currentTimeMillis()); short fs=25; Font font=new Font("SansSerif",Font.BOLD,fs); short sw=(short) ics.loadTextFont(font).drawTextWidth(met); short sh=(short) ics.drawTextHeight(met); Text2D content=new Text2D(new Point2D((mx-sw) / 2,(my-sh) / 2+sh / 3),met,ColorsArray.blackPoint.ic(),font); content.toPen(ics,pn.select(content)); Rectangle2D internal=new Rectangle2D(new Point2D((mx-sw) / 2,(my-sh) / 2),sw+1,sh,ColorsArray.magentaPoint.ic()); internal.toPen(ics,pn.select(internal));}} class BExperiment extends Shorty implements Kadr { BOkno recha; public BExperiment(BOkno r) { recha=r;} public void make(Graphics ics,short mx,short my) { BPlane lane=new BPlantronyx(); BSquare r; r=new BFon(rev(mx,21),rev(my,21),Color.red).ercent(rev2(mx,2),rev2(my,2)); r.impl(lane); BSimple si=new BSimple(Color.magenta); r=new BRama(si,mx,my).ercent(rev2(mx,2),rev2(my,2)); r.impl(lane); r=new BSimple(Color.blue,ext(0)).ercent(ext(rev2(mx,2),0),rev2(my,2)); r.impl(lane); r=new BSimple(Color.blue,ext(1)).ercent(ext(rev2(mx,2),10),rev2(my,2)); r.impl(lane); r=new BSimple(Color.blue,ext(2)).ercent(ext(rev2(mx,2),20),rev2(my,2)); r.impl(lane); r=new BSimple(Color.blue,ext(3)).ercent(ext(rev2(mx,2),30),rev2(my,2)); r.impl(lane); r=new BSimple(Color.blue,ext(4)).ercent(ext(rev2(mx,2),40),rev2(my,2)); r.impl(lane); ics.drawImage(lane.agu(recha),0,0,null);}} class BSometime extends Sleeper implements Runnable { Thread th; long doroga=11111L; public void run() { while(th !=null) { doroga+=17L; sleep(13);}} public void start() {(th=new Thread(this)).start();} public void stop() { th=null;} public short rshort() { return(short)(doroga+0);} public int rint() { return(int)(doroga-1);} public long rlong() { return(long)(doroga+1L);} public byte rbyte() { return(byte)(doroga-0);}} interface BPlane { BPlane set(short x,short y,Color c); Image agu(BOkno win);} interface BSquare { BSquare impl(BPlane xy); BSquare ercent(short cx,short cy); BSquare stepb3h(); BSquare stepb6h(); BSquare stepb9h(); BSquare stepb0h(); short shor(); short sver(); short b3h(); short b6h(); short b9h(); short b0h();} interface BUdot { BUdot ins(short x,short y,Color c); short x(); short y(); Color c();} class BUdotik implements BUdot { short x,y; Color c; public BUdot ins(short xx,short yy,Color cc) { x=xx; y=yy; c=cc; return this;} public short x() { return x;} public short y() { return y;} public Color c() { return c;}} class BPlantronyx extends Shorty implements BPlane { short minx,miny,maxx,maxy; Spiska ska; public BPlantronyx() { minx=miny=maxx=maxy=-1; ska=new Spiska();} public BPlane set(short x,short y,Color c) { if(minx==-1 && miny==-1) { minx=maxx=x; maxx=maxy=y;} else { minx=x < minx ? x : minx; maxx=x > maxx ? x : maxx; miny=y < miny ? y : miny; maxy=y > maxy ? y : maxy;} ska.append(new BUdotik().ins(x,y,c)); return this;} public Image agu(BOkno win) { Image mage=win.canva(ext(rev(maxx,minx)),ext(rev(maxy,miny))); if(mage !=null) { Graphics ics=mage.getGraphics(); for(int i=0; i < ska.size(); i++) { BUdot cur=(BUdot) ska.at((long) i); ics.setColor(cur.c()); ics.drawLine(cur.x(),cur.y(),cur.x(),cur.y());}} return mage;}} abstract class BDot extends Shorty implements BSquare { short cx,cy; public BDot() {} public BSquare ercent(short cxx,short cyy) { cx=cxx; cy=cyy; return this;} public BSquare stepb3h() { this.cx+=shor(); return this;} public BSquare stepb6h() { this.cy+=sver(); return this;} public BSquare stepb9h() { this.cx-=shor(); return this;} public BSquare stepb0h() { this.cy-=sver(); return this;}} class BSimple extends BDot { Color col; short dense=1; public BSimple() { this.col=Color.yellow;} public BSimple(Color col) { this.col=col;} public BSimple(Color col,short dense) { this.col=col; this.dense=dense;} public BSimple col(Color col) { this.col=col; return this;} public short shor() { return dense;} public short sver() { return dense;} public BSquare impl(BPlane pl) { short shift=rev2(dense,2); short delta=rev(dense,ext2(shift,2)); short mx=rev(cx,shift); short my=rev(cy,shift); short wx=rev(ext(cx,shift),delta==0 ? 1 : 0); short wy=rev(ext(cy,shift),delta==0 ? 1 : 0); short i=mx,j=my; while(i <= wx && j <= wy) { pl.set(i,j,col); i=ext(i); if(i > wx) { j=ext(j); i=mx;}} return this;} public short b3h() { return ext(cx,rev2(dense,2));} public short b6h() { return ext(cy,rev2(dense,2));} public short b9h() { return rev(cx,rev2(dense,2));} public short b0h() { return rev(cy,rev2(dense,2));}} class BFon extends BDot { Color col; short ww,hh; public BFon(short w,short h) { col=Color.orange; ww=w; hh=h;} public BFon(short w,short h,Color c) { col=c; ww=w; hh=h;} public BFon col(Color col) { this.col=col; return this;} public short shor() { return ww;} public short sver() { return hh;} public BSquare impl(BPlane pl) { short mx=rev(cx,rev2(ww,2)); short my=rev(cy,rev2(hh,2)); short wx=ext(mx,ww); short wy=ext(my,hh); short i=mx,j=my; while(i <= wx && j <= wy) { pl.set(i,j,col); i=ext(i); if(i > wx) { j=ext(j); i=mx;}} return this;} public short b3h() { return ext(cx,rev2(ww,2));} public short b6h() { return ext(cy,rev2(hh,2));} public short b9h() { return rev(cx,rev2(ww,2));} public short b0h() { return rev(cy,rev2(hh,2));}} class BRama implements BSquare { short b1,b2,b3,b4; BDot type; short uprava,uniz,cx,cy; public BRama(BDot type,short uprava,short uniz) { this.type=type; this.uprava=uprava; this.uniz=uniz;} public BSquare impl(BPlane pl) { short wx2=(short)(type.shor() * uprava / 2); short wy2=(short)(type.sver() * uniz / 2); type.ercent((short)(cx-wx2),(short)(cy-wy2)); short tmp; b4=type.b0h(); tmp=uprava; while(tmp--> 1) type.impl(pl).stepb3h(); b1=type.b3h(); tmp=uniz; while(tmp--> 1) type.impl(pl).stepb6h(); b2=type.b6h(); tmp=uprava; while(tmp--> 1) type.impl(pl).stepb9h(); b3=type.b9h(); tmp=uniz; while(tmp--> 1) type.impl(pl).stepb0h(); return this;} public short shor() { return(short)(type.shor() * uprava);} public short sver() { return(short)(type.sver() * uniz);} public short b3h() { return b1;} public short b6h() { return b2;} public short b9h() { return b3;} public short b0h() { return b4;} public BSquare ercent(short cxx,short cyy) { cx=cxx; cy=cyy; return this;} public BSquare stepb3h() { cx+=shor(); return this;} public BSquare stepb6h() { cy+=sver(); return this;} public BSquare stepb9h() { cx-=shor(); return this;} public BSquare stepb0h() { cy-=sver(); return this;}} class ToolbarLeftPanel extends Panel { LeftDefBtnPanel defBtnPanel; External3DPanel extPanel; Button btAuto; public ToolbarLeftPanel() { super(); setLayout(new BorderLayout()); setBackground(Color.gray); add("North",extPanel=new External3DPanel(false)); add("Center",defBtnPanel=new LeftDefBtnPanel()); add("South",new DemoAuto(btAuto=new Button("Auto")));} public boolean getExternal() { return getCbExt().getState();} public Checkbox getCbExt() { return extPanel.getCbExt();} public void enableCtrls(boolean enable) { btAuto.enable(enable); getCbExt().enable(enable); defBtnPanel.enableBtns(enable);} public LeftDefBtnPanel getDefBtnPanel() { return defBtnPanel;}} class LeftDefBtnPanel extends Panel { Button btDef; Button btRepo; public LeftDefBtnPanel() { super(); setLayout(new BorderLayout()); setBackground(Color.gray); add("North",btDef=new Button("Default")); add("Center",btRepo=new Button("Reposition"));} public void enableBtns(boolean enable) { btDef.enable(enable); btRepo.enable(enable);} public Button getBtDef() { return btDef;} public Button getBtRepo() { return btRepo;}} class DemoAuto extends Panel { Button autoBtn; public DemoAuto(Button autoBtn) { super(); this.autoBtn=autoBtn; setLayout(new FlowLayout(FlowLayout.CENTER,2+1,2)); setBackground(Color.yellow); add(autoBtn);}} class BOknoFrame { short w; short h; short x; short y; public boolean recall(Slip item) { String ati=new String(item.symbols()); int idx=ati.indexOf(","); if(idx < 0) return false; w=(short) Long.parseLong(ati.substring(0,idx)); ati=ati.substring(idx+1); idx=ati.indexOf(","); if(idx < 0) return false; h=(short) Long.parseLong(ati.substring(0,idx)); ati=ati.substring(idx+1); idx=ati.indexOf(","); if(idx < 0) return false; x=(short) Long.parseLong(ati.substring(0,idx)); ati=ati.substring(idx+1); y=(short) Long.parseLong(ati); return true;}} class BbbClOknoViewKadr implements Kadr { BOkno clOkno; Kadr kadranosecc; public BbbClOknoViewKadr(BOkno clOkno,Kadr kadranosecc) { super(); this.clOkno=clOkno; this.kadranosecc=kadranosecc;} public void make(Graphics ics,short mx,short my) { if(ics !=null) { Image im1=clOkno.canva((short)(mx+1),(short)(my+1)); Graphics ics2=im1.getGraphics(); kadranosecc.make(ics2,mx,my); BOknoFrame frame=new BOknoFrame(); frame.recall(clOkno.memo()); ics.drawImage(im1,frame.x,frame.y,null);}}} class BbbRightPanel extends Panel { Button btStop; Checkbox cbPreview; static boolean longTermOp; TextField tfProg; public BbbRightPanel() { super(); setLayout(new BorderLayout()); setBackground(Props.bgTopColor); add("South",tfProg=new TextField()); tfProg.enable(false); add("Center",btStop=new Button("Stop")); btStop.enable(false); add("North",cbPreview=new Checkbox("Preview&Close")); cbPreview.setState(false);} public Button getBtStop() { return btStop;} public Checkbox getCbPreview() { return cbPreview;} public TextField getTfProg() { return tfProg;} public boolean getPreview() { return cbPreview.getState();} public void setProgText(String txt) { tfProg.setText(txt);} public void disableStop() { btStop.enable(!true); cbPreview.enable(true); longTermOp=!true;} public void enableStop() { btStop.enable(true); cbPreview.enable(!true); longTermOp=true;} public boolean hasLongTermContin() { return longTermOp;}}
package mydev.bbb; import java.awt.Color; import java.awt.Event; import java.awt.Frame; import java.awt.Graphics; import java.awt.Image; import java.awt.Point; import mydev.aaa.Aaa; import mydev.aaa.Kadr; import mydev.aaa.Longy; import mydev.aaa.Shorty; import mydev.aaa.Sleeper; import mydev.aaa.Slip; import mydev.aaa.Stop; import mydev.about.CanvasAdapter; import mydev.about.CanvasAdapterAboutImpl; import mydev.about.ColorsArray; import mydev.about.PaintAdapter; import mydev.about.PaintAdapterAboutImpl; import mydev.about.Point2D; import mydev.about.Rectangle2D; import mydev.about.Text2D; import mydev.uix.Better; import mydev.uix.GeoLayoutBuilder; import mydev.uix.Props; import mydev.uix.Timer; import mydev.uix.WidthHeight; import mydev.vutils.TimeTracking; import mydev.vutils.Queue; public class Bbb extends Frame implements Runnable,Stop { final short fin=18; static Shorty rt=Enter2.instance().shorty(); static Longy lg=Enter2.instance().longy(); static BSometime som=Enter2.instance().sometime(); boolean autoEnabled=false; InternalPlane oknosPlane; PreviewRightPanel topPanel; ToolbarLeftPanel leftPanel; protected Aaa app; static short[] w={ 0,230,240,250,260,199}; static short[] h={ 0,170,160,140,130,155}; static short[] x={ 0,31,311,635,924,rt.rev2(rt.rev(1366,w[5]),2)}; static short[] y={ 0,19,500,150,300,rt.rev2(rt.rev(768,h[5]),2)}; BOknoManager oknoManager; public Bbb() { super("BbbAaa");} void prepare() { GeoLayoutBuilder.create().bgColor(Color.white).appendEast(topPanel=new PreviewRightPanel()).appendCenter(oknosPlane=new InternalPlane(Color.gray,Color.lightGray)).appendWest(leftPanel=new ToolbarLeftPanel(false)).build(this); oknoManager=new BOknoManager(oknosPlane);} public static void main(String[] args) { Bbb main=new Bbb(); System.out.print("HelloWindWorld"); main.prepare(); main.resize((short)(800 *(1.f+1.f-.4f+.15f-.06f+0.044f-.0056f+.0465999f)),(short)(600 * 1.16667f)); main.show(); main.reMoveRnd(); main.start(); System.out.println("main!"); Sleeper sleeper=new Sleeper(); if(Props.mainLower) Thread.currentThread().setPriority(Thread.MIN_PRIORITY); while(Better.working) { main.refreshUpdatable(); TimeTracking.memTrack(); sleeper.sleep(Timer.DEF_REF_TIME);} main.ka(); main.hide(); main.dispose(); System.exit(1-1);} public boolean handleEvent(Event et) { if(et.id==Event.WINDOW_DESTROY) new Better().exitApplicationLoop(); if(et.id==Event.ACTION_EVENT && et.target==leftPanel.getDemoAuto().getBtAuto()) auto(); if(et.id==Event.ACTION_EVENT && et.target==leftPanel.getCbExt()) extInternal(leftPanel.getExternal()); if(et.id==Event.ACTION_EVENT && et.target==leftPanel.getDefBtnPanel().getBtRepo()) reposition(leftPanel.getExternal()); if(et.id==Event.ACTION_EVENT && et.target==topPanel.getBtStop()) topPanel.disableStop(); if(et.id==Event.ACTION_EVENT && et.target==leftPanel.getDefBtnPanel().getBtDef()) { leftPanel.getDefBtnPanel().getWhPanel().whReset(); reset(leftPanel.getExternal());} Object tg=et.target; if(tg !=null && tg.equals(leftPanel.getDefBtnPanel().getWhPanel().getTfWidth()) && et.id==Event.LOST_FOCUS) commonWidthHeightChanges(leftPanel.getDefBtnPanel().getWhPanel()); if(tg !=null && tg.equals(leftPanel.getDefBtnPanel().getWhPanel().getTfHeight()) && et.id==Event.LOST_FOCUS) commonWidthHeightChanges(leftPanel.getDefBtnPanel().getWhPanel()); return super.handleEvent(et);} private void commonWidthHeightChanges(WidthHeight whPanel) { short commonWidth=(short) Integer.parseInt(whPanel.getWidthTxt()); short commonHeight=(short) Integer.parseInt(whPanel.getHeightTxt()); oknoManager.updateCommonWidthHeightAllWindows(commonWidth,commonHeight); oknosPlane.performRepaint();} public void start() { reloadInternal();} private void extInternal(boolean ext) { hideAllWindows(); if(ext) reloadExternal(); else reloadInternal();} private void hideAllWindows() { ka();} private void reloadInternal() { som.start(); Bbb pi=(Bbb) this; oknoManager.saveCloseAllWindows(); oknoManager.reloadInternal(this);} private void reloadExternal() { app=new Aaa(); app.entrypoint();} private void reset(boolean ext) { if(ext) { hideAllWindows(); reloadInternal();} oknoManager.reset(); extInternal(leftPanel.getExternal()); oknosPlane.performRepaint();} private void reposition(boolean ext) { if(ext) repositionExternal(); else repositionInternal(); oknosPlane.performRepaint();} private void repositionInternal() { oknoManager.repositionInternal();} private void repositionExternal() { hideAllWindows(); reloadInternal(); oknoManager.repositionExternal(this); hideAllWindows(); reloadExternal();} public void run() { topPanel.enableStop(); Sleeper sleeper=new Sleeper(); int i; for(i=0; topPanel.hasLongTermContin() && i < fin; i++) { topPanel.setProgText(""+(fin-i)); reposition(false); sleeper.sleep((long)(2300 * 2.12));} if(topPanel.hasLongTermContin()) { topPanel.setProgText(""+(fin-i)); reset(false); sleeper.sleep((long)(2300 * 2.12));} if(topPanel.getPreview() && topPanel.hasLongTermContin()) new Better().exitApplicationLoop(); leftPanel.enableCtrls(true); topPanel.disableStop(); topPanel.setProgText("");} private void auto() { leftPanel.enableCtrls(false); new Thread(this).start();} private void refreshUpdatable() { if(oknosPlane.checkRepaint()) oknosPlane.performRepaint(); topPanel.refreshUpdatable();} protected void reMoveRnd() { Location ol=Enter2.instance().location(); Point p=ol.getRandomExternalPos((short)(800 *(1.f+1.f-.4f+.15f-.06f+0.044f-.0056f+.0465999f)),(short)(600 * 1.16667f)); move(p.x,p.y);} public void ka() { if(app !=null) { app.ka(); app=null;} else oknoManager.saveCloseAllWindows(); oknosPlane.clearBOknos(); oknosPlane.performRepaint(); som.stop();}} class BOknoManager extends AbstractOknoManager implements Kadr { InternalPlane oknosPlane; public BOknoManager(InternalPlane oknosPlane) { super(); this.oknosPlane=oknosPlane;} public void reloadInternal(Stop ka) { BOkno bOkno; Kadr bOknoKadr=this;(bOkno=Enter2.instance().okno(oknosPlane)).size(Bbb.w[1],Bbb.h[1]).move(Bbb.x[1],Bbb.y[1]).kadr(new BOknoViewKadr(bOkno,bOknoKadr)).show(ka,"aa1"); addOkno(bOkno);(bOkno=Enter2.instance().okno(oknosPlane)).size(Bbb.w[2],Bbb.h[2]).move(Bbb.x[2],Bbb.y[2]).kadr(new BOknoViewKadr(bOkno,bOknoKadr)).show(ka,"aa2"); addOkno(bOkno);(bOkno=Enter2.instance().okno(oknosPlane)).size(Bbb.w[3],Bbb.h[3]).move(Bbb.x[3],Bbb.y[3]).kadr(new BOknoViewKadr(bOkno,bOknoKadr)).show(ka,"aa3"); addOkno(bOkno);(bOkno=Enter2.instance().okno(oknosPlane)).size(Bbb.w[4],Bbb.h[4]).move(Bbb.x[4],Bbb.y[4]).kadr(new BOknoViewKadr(bOkno,bOknoKadr)).show(ka,"aa4"); addOkno(bOkno);(bOkno=Enter2.instance().okno(oknosPlane)).size(Bbb.w[5],Bbb.h[5]).move(Bbb.x[5],Bbb.y[5]).kadr(new BOknoViewKadr(bOkno,new BExperiment(bOkno))).show(ka,"aaa"); addOkno(bOkno);} public void reset() { getOkno("aa1").size(Bbb.w[1],Bbb.h[1]).move(Bbb.x[1],Bbb.y[1]); getOkno("aa2").size(Bbb.w[2],Bbb.h[2]).move(Bbb.x[2],Bbb.y[2]); getOkno("aa3").size(Bbb.w[3],Bbb.h[3]).move(Bbb.x[3],Bbb.y[3]); getOkno("aa4").size(Bbb.w[4],Bbb.h[4]).move(Bbb.x[4],Bbb.y[4]); getOkno("aaa").size(Bbb.w[5],Bbb.h[5]).move(Bbb.x[5],Bbb.y[5]);} public void hideAllWindows() {} public void reloadExternal() {} public void make(Graphics cs1,short mx,short my) { CanvasAdapter ics=new CanvasAdapterAboutImpl(cs1,oknosPlane); PaintAdapter pn=new PaintAdapterAboutImpl(oknosPlane); Rectangle2D bg=new Rectangle2D(new Point2D(1-1,1-1),mx+1,my+1,ColorsArray.orangePoint.ic(),true); bg.toPen(ics,pn.select(bg)); Rectangle2D border=new Rectangle2D(new Point2D(0,0),mx+1,my+1,ColorsArray.magentaPoint.ic()); border.toPen(ics,pn.select(border)); String met=""+Bbb.lg.ext(Bbb.som.rlong(),System.currentTimeMillis()); short sw=(short) ics.drawTextWidth(met); short sh=(short) ics.drawTextHeight(met); Text2D content=new Text2D(new Point2D((mx-sw) / 2,(my-sh) / 2+sh / 3),met,ColorsArray.blackPoint.ic()); content.toPen(ics,pn.select(content)); Rectangle2D internal=new Rectangle2D(new Point2D((mx-sw) / 2-1,(my-sh) / 2),sw+1+1,sh,ColorsArray.magentaPoint.ic()); internal.toPen(ics,pn.select(internal));}} class BExperiment extends Shorty implements Kadr { BOkno recha; public BExperiment(BOkno r) { recha=r;} public void make(Graphics ics,short mx,short my) { BPlane lane=new BPlantronyx(); BSquare r; r=new BFon(rev(mx,21),rev(my,21),Color.red).ercent(rev2(mx,2),rev2(my,2)); r.impl(lane); BSimple si=new BSimple(Color.magenta); short mx2=(short)(mx+1); short my2=(short)(my+1); r=new BRama(si,mx2,my2).ercent(rev2(mx2,2),rev2(my2,2)); r.impl(lane); r=new BSimple(Color.blue,ext(0)).ercent(ext(rev2(mx,2),0),rev2(my,2)); r.impl(lane); r=new BSimple(Color.blue,ext(1)).ercent(ext(rev2(mx,2),10),rev2(my,2)); r.impl(lane); r=new BSimple(Color.blue,ext(2)).ercent(ext(rev2(mx,2),20),rev2(my,2)); r.impl(lane); r=new BSimple(Color.blue,ext(3)).ercent(ext(rev2(mx,2),30),rev2(my,2)); r.impl(lane); r=new BSimple(Color.blue,ext(4)).ercent(ext(rev2(mx,2),40),rev2(my,2)); r.impl(lane); ics.drawImage(lane.agu(recha),0,0,null);}} class BSometime extends Sleeper implements Runnable { Thread th; long doroga=11111L; public void run() { while(th !=null) { doroga+=17L; sleep(13);}} public void start() {(th=new Thread(this)).start();} public void stop() { th=null;} public short rshort() { return(short)(doroga+0);} public int rint() { return(int)(doroga-1);} public long rlong() { return(long)(doroga+1L);} public byte rbyte() { return(byte)(doroga-0);}} interface BPlane { BPlane set(short x,short y,Color c); Image agu(BOkno win);} interface BSquare { BSquare impl(BPlane xy); BSquare ercent(short cx,short cy); BSquare stepb3h(); BSquare stepb6h(); BSquare stepb9h(); BSquare stepb0h(); short shor(); short sver(); short b3h(); short b6h(); short b9h(); short b0h();} interface BUdot { BUdot ins(short x,short y,Color c); short x(); short y(); Color c();} class BUdotik implements BUdot { short x,y; Color c; public BUdot ins(short xx,short yy,Color cc) { x=xx; y=yy; c=cc; return this;} public short x() { return x;} public short y() { return y;} public Color c() { return c;}} class BPlantronyx extends Shorty implements BPlane { short minx,miny,maxx,maxy; Queue ska; public BPlantronyx() { minx=miny=maxx=maxy=-1; ska=new Queue();} public BPlane set(short x,short y,Color c) { if(minx==-1 && miny==-1) { minx=maxx=x; maxx=maxy=y;} else { minx=x < minx ? x : minx; maxx=x > maxx ? x : maxx; miny=y < miny ? y : miny; maxy=y > maxy ? y : maxy;} ska.enqueueQueueRecord(new BUdotik().ins(x,y,c)); return this;} public Image agu(BOkno win) { Image mage=win.canva(ext(rev(maxx,minx)),ext(rev(maxy,miny))); if(mage !=null) { Graphics ics=mage.getGraphics(); Queue iter=ska.quickQueueCopy(); while(iter.sizeOfQueue() > 0) { BUdot cur=(BUdot) iter.dequeueQueueRecord(); ics.setColor(cur.c()); ics.drawLine(cur.x(),cur.y(),cur.x(),cur.y());}} return mage;}} abstract class BDot extends Shorty implements BSquare { short cx,cy; public BDot() {} public BSquare ercent(short cxx,short cyy) { cx=cxx; cy=cyy; return this;} public BSquare stepb3h() { this.cx+=shor(); return this;} public BSquare stepb6h() { this.cy+=sver(); return this;} public BSquare stepb9h() { this.cx-=shor(); return this;} public BSquare stepb0h() { this.cy-=sver(); return this;}} class BSimple extends BDot { Color col; short dense=1; public BSimple() { this.col=Color.yellow;} public BSimple(Color col) { this.col=col;} public BSimple(Color col,short dense) { this.col=col; this.dense=dense;} public BSimple col(Color col) { this.col=col; return this;} public short shor() { return dense;} public short sver() { return dense;} public BSquare impl(BPlane pl) { short shift=rev2(dense,2); short delta=rev(dense,ext2(shift,2)); short mx=rev(cx,shift); short my=rev(cy,shift); short wx=rev(ext(cx,shift),delta==0 ? 1 : 0); short wy=rev(ext(cy,shift),delta==0 ? 1 : 0); short i=mx,j=my; while(i <= wx && j <= wy) { pl.set(i,j,col); i=ext(i); if(i > wx) { j=ext(j); i=mx;}} return this;} public short b3h() { return ext(cx,rev2(dense,2));} public short b6h() { return ext(cy,rev2(dense,2));} public short b9h() { return rev(cx,rev2(dense,2));} public short b0h() { return rev(cy,rev2(dense,2));}} class BFon extends BDot { Color col; short ww,hh; public BFon(short w,short h) { col=Color.orange; ww=w; hh=h;} public BFon(short w,short h,Color c) { col=c; ww=w; hh=h;} public BFon col(Color col) { this.col=col; return this;} public short shor() { return ww;} public short sver() { return hh;} public BSquare impl(BPlane pl) { short mx=rev(cx,rev2(ww,2)); short my=rev(cy,rev2(hh,2)); short wx=ext(mx,ww); short wy=ext(my,hh); short i=mx,j=my; while(i <= wx && j <= wy) { pl.set(i,j,col); i=ext(i); if(i > wx) { j=ext(j); i=mx;}} return this;} public short b3h() { return ext(cx,rev2(ww,2));} public short b6h() { return ext(cy,rev2(hh,2));} public short b9h() { return rev(cx,rev2(ww,2));} public short b0h() { return rev(cy,rev2(hh,2));}} class BRama implements BSquare { short b1,b2,b3,b4; BDot type; short uprava,uniz,cx,cy; public BRama(BDot type,short uprava,short uniz) { this.type=type; this.uprava=uprava; this.uniz=uniz;} public BSquare impl(BPlane pl) { short wx2=(short)(type.shor() * uprava / 2); short wy2=(short)(type.sver() * uniz / 2); type.ercent((short)(cx-wx2),(short)(cy-wy2)); short tmp; b4=type.b0h(); tmp=uprava; while(tmp--> 1) type.impl(pl).stepb3h(); b1=type.b3h(); tmp=uniz; while(tmp--> 1) type.impl(pl).stepb6h(); b2=type.b6h(); tmp=uprava; while(tmp--> 1) type.impl(pl).stepb9h(); b3=type.b9h(); tmp=uniz; while(tmp--> 1) type.impl(pl).stepb0h(); return this;} public short shor() { return(short)(type.shor() * uprava);} public short sver() { return(short)(type.sver() * uniz);} public short b3h() { return b1;} public short b6h() { return b2;} public short b9h() { return b3;} public short b0h() { return b4;} public BSquare ercent(short cxx,short cyy) { cx=cxx; cy=cyy; return this;} public BSquare stepb3h() { cx+=shor(); return this;} public BSquare stepb6h() { cy+=sver(); return this;} public BSquare stepb9h() { cx-=shor(); return this;} public BSquare stepb0h() { cy-=sver(); return this;}} class BOknoFrame { short w; short h; short x; short y; public boolean recall(Slip item) { String ati=new String(item.symbols()); int idx=ati.indexOf(","); if(idx < 0) return false; w=(short) Long.parseLong(ati.substring(0,idx)); ati=ati.substring(idx+1); idx=ati.indexOf(","); if(idx < 0) return false; h=(short) Long.parseLong(ati.substring(0,idx)); ati=ati.substring(idx+1); idx=ati.indexOf(","); if(idx < 0) return false; x=(short) Long.parseLong(ati.substring(0,idx)); ati=ati.substring(idx+1); y=(short) Long.parseLong(ati); return true;} public String toString() { return "BOknoFrame [w="+w+", h="+h+", x="+x+", y="+y+"]";}} class BOknoViewKadr extends AbstractViewKadr { BOkno bOkno; public BOknoViewKadr(BOkno bOkno,Kadr kadranosecc) { super(kadranosecc); this.bOkno=bOkno;} protected Image canvaCreate(short mx,short my) { return bOkno.canva((short)(mx+1),(short)(my+1));} protected Slip getMemo() { return bOkno.memo();}}

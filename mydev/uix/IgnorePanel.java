package mydev.uix; import java.awt.BorderLayout; import java.awt.Checkbox; import java.awt.Color; import java.awt.Label; import java.awt.Panel; import java.awt.TextArea; import java.io.File; import java.io.IOException; import mydev.aaa.IO; import mydev.vutils.Ester; import mydev.vutils.Stack; public class IgnorePanel extends Panel { final static boolean D=false; private TextArea taIgnoreList; private StopIgnorePanel stopIgnore; protected String ignoreListRem; protected Stack ign=new Stack(); public IgnorePanel() { super(); setLayout(new BorderLayout()); Color bgColor=getPanelBgColor(); setBackground(bgColor); add("Center",taIgnoreList=new TextArea(4,4)); add("North",stopIgnore=new StopIgnorePanel(bgColor,getIgnoreLabel(),getCancelLabel())); taIgnoreList.setText("");} public void setIgnoreList(String ignoreList) { if(ignoreList !=null) taIgnoreList.setText(ignoreList);} public Color getPanelBgColor() { return Color.gray;} public String getIgnoreLabel() { return "Ignore list:";} public String getCancelLabel() { return "cancel ignore";} public TextArea getTaIgnoreList() { return taIgnoreList;} public StopIgnorePanel getStopIgnore() { return stopIgnore;} public void onCancelIgnore() { taIgnoreList.enable(!stopIgnore.isCancelIgnore());} public String getIgnoreList() { if(stopIgnore.isCancelIgnore()) return ""; return taIgnoreList.getText();} public Checkbox getCbCancelIgnore() { return stopIgnore.getCbCancelIgnore();} public void setCancelIgnore(boolean enable) { getCbCancelIgnore().setState(enable);} public boolean isCancelIgnore() { return getCbCancelIgnore().getState();} public void changeState() { boolean state=isCancelIgnore(); setCancelIgnore(!state); taIgnoreList.enable(state);} public boolean hasIgnoreCoincidence(String absPath) { ignUpdate(); if(hasIgnoreCoincidenceFname(absPath)) return true; if(hasIgnoreCoincidencePkg(absPath)) return true; return false;} protected void ignUpdate() { String ignoreList=getIgnoreList(); if(ignoreListRem==null) { ignoreListRem=ignoreList; ign=getLines(ignoreList);} else if(!ignoreListRem.equalsIgnoreCase(ignoreList)) { ign=getLines(ignoreList); ignoreListRem=ignoreList;}} protected boolean hasIgnoreCoincidencePkg(String absPath) { try { byte[] data=new IO().read(absPath); String content=new Ester(data).toString(); Object[] stackRecordsArray=ign.getStackRecordsArray(); for(int i=0; i < stackRecordsArray.length; i++) { String c=(String) stackRecordsArray[i]; boolean contains=content.indexOf(c) >= 0; if(IgnorePanel.D) System.out.println(" C <"+c+"> "+contains+" "+new File(absPath).getName()); if(contains) return true;}} catch(IOException e) { e.printStackTrace();} return false;} protected boolean hasIgnoreCoincidenceFname(String absPath) { Ester item=new Ester(absPath); Object[] stackRecordsArray=ign.getStackRecordsArray(); for(int i=0; i < stackRecordsArray.length; i++) { String c=(String) stackRecordsArray[i]; boolean contains=item.ends(new Ester(c)); if(IgnorePanel.D) System.out.println(" C <"+absPath+"> "+contains+" "+c); if(contains) return true;} return false;} protected Stack getLines(String ignoreList) { Stack list=new Stack(); int idx; do { idx=ignoreList.lastIndexOf('\n'); if(idx >= 0) { String cur=ignoreList.substring(idx+1); list.push(cur); ignoreList=ignoreList.substring(0,idx);}} while(idx >= 0); if(ignoreList.length() > 0) list.push(ignoreList); return list;}} class StopIgnorePanel extends Panel { private Checkbox cbCancelIgnore; public StopIgnorePanel(Color bgColor,String ignoreLabel,String cancelLabel) { super(); setLayout(new BorderLayout()); setBackground(bgColor); add("West",new Label(ignoreLabel)); add("East",cbCancelIgnore=new Checkbox(cancelLabel));} public Checkbox getCbCancelIgnore() { return cbCancelIgnore;} public boolean isCancelIgnore() { return cbCancelIgnore.getState();}}
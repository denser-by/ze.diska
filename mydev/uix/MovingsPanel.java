package mydev.uix; import java.awt.Canvas; import java.awt.Color; import java.awt.Dimension; import java.awt.Event; import java.awt.Graphics; public class MovingsPanel extends Canvas { final static Color BTN_BACK=Color.darkGray; final static Color BTN_FACE=Color.white; final static Color BTN_PRESS=Color.black; final static short DEF_WIDTH=220; final static short DEF_HEIGHT=130; private Color hPen1; private Color hPen12; private Color hPen2; private Color hPrevPen; protected short pressForward; protected short pressBackward; protected short pressLeft; protected short pressRight; protected short pressUp; protected short pressDown; protected short pressCtrl; private Graphics ics; private boolean needRepaint; private short cx; private short cy; protected short active; protected short caBot; protected short caRight; protected int side; protected int step; public MovingsPanel(short panelWidth,short panelHeight) { super(); resize(panelWidth,panelHeight); this.pressForward=0x7fff; this.pressBackward=(short) Long.MIN_VALUE; drop(); this.pressCtrl=0; this.active=0; this.caRight=panelWidth; this.caBot=panelHeight; this.needRepaint=false; this.side=caBot / 5; this.step=side * 3 / 7;} public MovingsPanel() { this(DEF_WIDTH,DEF_HEIGHT);} protected void LineTo(int x,int y) { ics.drawLine(cx,cy,x,y); cx=(short) x; cy=(short) y;} protected void MoveToEx(int x,int y) { cx=(short) x; cy=(short) y;} public Color RGB(int r,int g,int b) { return new Color(b,g,r);} protected Color Sq4Points(float x1,float y1,float x2,float y2,float x3,float y3,float x4,float y4,Color col) { Color c11=ics.getColor(); ics.setColor(col); int[] xps=new int[4]; int[] yps=new int[4]; xps[0]=(int) x1; xps[0+1]=(int) x2; xps[0+1+1]=(int) x3; xps[0+1+1+1]=(int) x4; yps[0]=(int) y1; yps[0+1]=(int) y2; yps[0+1+1]=(int) y3; yps[0+1+1+1]=(int) y4; ics.fillPolygon(xps,yps,4); return c11;} public void paint(Graphics cs) { super.paint(cs); this.ics=cs; Dimension d=size(); cs.setColor(Color.gray); cs.fillRect(0,0,d.width-1,d.height-1); cs.setColor(Color.black); cs.drawRect(0,0,d.width-1,d.height-1); if(hPen1==null) { hPen1=BTN_FACE; hPen12=RGB(10,242,255); hPen2=BTN_PRESS;} hPrevPen=hPen2; buttonForwards(cs); buttonBackwards(cs); buttonLeft(cs); buttonRight(cs); buttonUp(cs); buttonDown(cs);} protected void buttonDown(Graphics cs) { Sq4Points(caRight / 2-side+2 * side+step,caBot / 2-step / 2-2 * side,caRight / 2+side+2 * side+step,caBot / 2-step / 2-2 * side,caRight / 2+side+2 * side+step,caBot / 2-step / 2,caRight / 2-side+2 * side+step,caBot / 2-step / 2,BTN_BACK); cs.setColor(pressDown==1 ? hPen2 : active==6 ? hPen12 : hPen1); MoveToEx(caRight / 2-side+2 * side+step,caBot / 2-step / 2-2 * side); LineTo(caRight / 2+side+2 * side+step,caBot / 2-step / 2-2 * side); LineTo(caRight / 2+side+2 * side+step,caBot / 2-step / 2); LineTo(caRight / 2-side+2 * side+step,caBot / 2-step / 2); LineTo(caRight / 2-side+2 * side+step,caBot / 2-step / 2-2 * side); MoveToEx(caRight / 2-side+step / 2+2 * side+step,caBot / 2-step / 2-side); LineTo(caRight / 2+2 * side+step,caBot / 2-step+1); LineTo(caRight / 2+side-step / 2+2 * side+step,caBot / 2-step / 2-side); MoveToEx(caRight / 2-side+step / 2+2 * side+step,caBot / 2-2 * side); LineTo(caRight / 2+2 * side+step,caBot / 2-step-side+step / 2+1); LineTo(caRight / 2+side-step / 2+2 * side+step,caBot / 2-2 * side); cs.setColor(hPrevPen);} protected void buttonUp(Graphics cs) { Sq4Points(caRight / 2-side-2 * side-step,caBot / 2-step / 2-2 * side,caRight / 2+side-2 * side-step,caBot / 2-step / 2-2 * side,caRight / 2+side-2 * side-step,caBot / 2-step / 2,caRight / 2-side-2 * side-step,caBot / 2-step / 2,BTN_BACK); cs.setColor(pressUp==1 ? hPen2 : active==5 ? hPen12 : hPen1); MoveToEx(caRight / 2-side-2 * side-step,caBot / 2-step / 2-2 * side); LineTo(caRight / 2+side-2 * side-step,caBot / 2-step / 2-2 * side); LineTo(caRight / 2+side-2 * side-step,caBot / 2-step / 2); LineTo(caRight / 2-side-2 * side-step,caBot / 2-step / 2); LineTo(caRight / 2-side-2 * side-step,caBot / 2-step / 2-2 * side); MoveToEx(caRight / 2-side+step / 2-2 * side-step,caBot / 2-step / 2-side); LineTo(caRight / 2-2 * side-step,caBot / 2-step-2 * side+step); LineTo(caRight / 2+side-step / 2-2 * side-step,caBot / 2-step / 2-side); MoveToEx(caRight / 2-side+step / 2-2 * side-step,caBot / 2-step / 2-side+side-step / 2); LineTo(caRight / 2-2 * side-step,caBot / 2-step-2 * side+step+side-step / 2); LineTo(caRight / 2+side-step / 2-2 * side-step,caBot / 2-step / 2-side+side-step / 2); cs.setColor(hPrevPen);} protected void buttonRight(Graphics cs) { Sq4Points(caRight / 2-side+step+2 * side,caBot / 2-step / 2-2 * side+2 * side+step,caRight / 2+side+step+2 * side,caBot / 2-step / 2-2 * side+2 * side+step,caRight / 2+side+step+2 * side,caBot / 2-step / 2-2 * side+2 * side+2 * side+step,caRight / 2-side+step+2 * side,caBot / 2-step / 2-2 * side+2 * side+2 * side+step,BTN_BACK); cs.setColor(pressRight==1 ? hPen2 : active==4 ? hPen12 : hPen1); MoveToEx(caRight / 2-side+step+2 * side,caBot / 2-step / 2-2 * side+2 * side+step); LineTo(caRight / 2+side+step+2 * side,caBot / 2-step / 2-2 * side+2 * side+step); LineTo(caRight / 2+side+step+2 * side,caBot / 2-step / 2-2 * side+2 * side+2 * side+step); LineTo(caRight / 2-side+step+2 * side,caBot / 2-step / 2-2 * side+2 * side+2 * side+step); LineTo(caRight / 2-side+step+2 * side,caBot / 2-step / 2-2 * side+2 * side+step); MoveToEx(caRight / 2-side-step+3 * side,caBot / 2-step / 2+step+side); LineTo(caRight / 2-side-step+3 * side+2 * side-step,caBot / 2-step / 2+step+side); MoveToEx(caRight / 2-step-step / 2+3 * side-1,caBot / 2+step); LineTo(caRight / 2+step / 2+3 * side,caBot / 2-step / 2+step+side); LineTo(caRight / 2-step-step / 2+3 * side,caBot / 2+2 * side); cs.setColor(hPrevPen);} protected void buttonLeft(Graphics cs) { Sq4Points(caRight / 2-side-step-2 * side,caBot / 2-step / 2+step,caRight / 2+side-step-2 * side,caBot / 2-step / 2+step,caRight / 2+side-step-2 * side,caBot / 2-step / 2+2 * side+step,caRight / 2-side-step-2 * side,caBot / 2-step / 2+2 * side+step,BTN_BACK); cs.setColor(pressLeft==1 ? hPen2 : active==3 ? hPen12 : hPen1); MoveToEx(caRight / 2-side-step-2 * side,caBot / 2-step / 2+step); LineTo(caRight / 2+side-step-2 * side,caBot / 2-step / 2+step); LineTo(caRight / 2+side-step-2 * side,caBot / 2-step / 2+2 * side+step); LineTo(caRight / 2-side-step-2 * side,caBot / 2-step / 2+2 * side+step); LineTo(caRight / 2-side-step-2 * side,caBot / 2-step / 2+step); MoveToEx(caRight / 2-side-step / 2-2 * side,caBot / 2-step / 2+step+side); LineTo(caRight / 2-side-step / 2-2 * side+2 * side-step,caBot / 2-step / 2+step+side); MoveToEx(caRight / 2-step-2 * side+1,caBot / 2+step); LineTo(caRight / 2-side-step / 2-2 * side,caBot / 2-step / 2+step+side); LineTo(caRight / 2-step-2 * side,caBot / 2+2 * side); cs.setColor(hPrevPen);} protected void buttonBackwards(Graphics cs) { Sq4Points(caRight / 2-side,caBot / 2-step / 2-2 * side+2 * side+step,caRight / 2+side,caBot / 2-step / 2-2 * side+2 * side+step,caRight / 2+side,caBot / 2-step / 2+2 * side+step,caRight / 2-side,caBot / 2-step / 2+2 * side+step,BTN_BACK); cs.setColor(pressBackward==1 ? hPen2 : active==2 ? hPen12 : hPen1); MoveToEx(caRight / 2-side,caBot / 2-step / 2-2 * side+2 * side+step); LineTo(caRight / 2+side,caBot / 2-step / 2-2 * side+2 * side+step); LineTo(caRight / 2+side,caBot / 2-step / 2+2 * side+step); LineTo(caRight / 2-side,caBot / 2-step / 2+2 * side+step); LineTo(caRight / 2-side,caBot / 2-step / 2-2 * side+2 * side+step); MoveToEx(caRight / 2,caBot / 2-step+2 * side+step); LineTo(caRight / 2,caBot / 2-step-2 * side+step+2 * side+step); MoveToEx(caRight / 2-side+step / 2,caBot / 2-step / 2-side+2 * side+step); LineTo(caRight / 2,caBot / 2-step+2 * side+step+1); LineTo(caRight / 2+side-step / 2,caBot / 2-step / 2-side+2 * side+step); cs.setColor(hPrevPen);} protected void buttonForwards(Graphics cs) { Sq4Points(caRight / 2-side,caBot / 2-step / 2-2 * side,caRight / 2+side,caBot / 2-step / 2-2 * side,caRight / 2+side,caBot / 2-step / 2,caRight / 2-side,caBot / 2-step / 2,BTN_BACK); cs.setColor(pressForward==1 ? hPen2 : active==1 ? hPen12 : hPen1); MoveToEx(caRight / 2-side,caBot / 2-step / 2-2 * side); LineTo(caRight / 2+side,caBot / 2-step / 2-2 * side); LineTo(caRight / 2+side,caBot / 2-step / 2); LineTo(caRight / 2-side,caBot / 2-step / 2); LineTo(caRight / 2-side,caBot / 2-step / 2-2 * side); MoveToEx(caRight / 2,caBot / 2-step); LineTo(caRight / 2,caBot / 2-step-2 * side+step); MoveToEx(caRight / 2-side+step / 2,caBot / 2-step / 2-side); LineTo(caRight / 2,caBot / 2-step-2 * side+step); LineTo(caRight / 2+side-step / 2,caBot / 2-step / 2-side); cs.setColor(hPrevPen);} public boolean mouseDown(Event et,int mx,int my) { drop(); if(caRight / 2-side <= mx && mx <= caRight / 2+side && caBot / 2-step / 2-2 * side <= my && my <= caBot / 2-step / 2) pressForward=1; if(caRight / 2-side <= mx && mx <= caRight / 2+side && caBot / 2-step / 2-2 * side+2 * side+step <= my && my <= caBot / 2-step / 2+2 * side+step) pressBackward=1; if(caRight / 2-side-step-2 * side <= mx && mx <= caRight / 2+side-step-2 * side && caBot / 2-step / 2+step <= my && my <= caBot / 2-step / 2+2 * side+step) pressLeft=1; if(caRight / 2-side+step+2 * side <= mx && mx <= caRight / 2+side+step+2 * side && caBot / 2-step / 2-2 * side+2 * side+step <= my && my <= caBot / 2-step / 2-2 * side+2 * side+2 * side+step) pressRight=1; if(caRight / 2-side-2 * side-step <= mx && mx <= caRight / 2+side-2 * side-step && caBot / 2-step / 2-2 * side <= my && my <= caBot / 2-step / 2) pressUp=1; if(caRight / 2-side+2 * side+step <= mx && mx <= caRight / 2+side+2 * side+step && caBot / 2-step / 2-2 * side <= my && my <= caBot / 2-step / 2) pressDown=1; prepareUpdate(); return super.mouseDown(et,mx,my);} public boolean mouseUp(Event et,int x,int y) { drop(); prepareUpdate(); return super.mouseUp(et,x,y);} public void prepareUpdate() { needRepaint=true;} public boolean mouseMove(Event et,int mx,int my) { active=0; if(caRight / 2-side <= mx && mx <= caRight / 2+side && caBot / 2-step / 2-2 * side <= my && my <= caBot / 2-step / 2) active=1; if(caRight / 2-side <= mx && mx <= caRight / 2+side && caBot / 2-step / 2-2 * side+2 * side+step <= my && my <= caBot / 2-step / 2+2 * side+step) active=2; if(caRight / 2-side-step-2 * side <= mx && mx <= caRight / 2+side-step-2 * side && caBot / 2-step / 2+step <= my && my <= caBot / 2-step / 2+2 * side+step) active=3; if(caRight / 2-side+step+2 * side <= mx && mx <= caRight / 2+side+step+2 * side && caBot / 2-step / 2-2 * side+2 * side+step <= my && my <= caBot / 2-step / 2-2 * side+2 * side+2 * side+step) active=4; if(caRight / 2-side-2 * side-step <= mx && mx <= caRight / 2+side-2 * side-step && caBot / 2-step / 2-2 * side <= my && my <= caBot / 2-step / 2) active=5; if(caRight / 2-side+2 * side+step <= mx && mx <= caRight / 2+side+2 * side+step && caBot / 2-step / 2-2 * side <= my && my <= caBot / 2-step / 2) active=6; prepareUpdate(); return super.mouseMove(et,mx,my);} public void refreshUpdatable() { if(needRepaint) { needRepaint=false; repaint();}} public boolean isForward() { return pressForward==1;} public boolean isBackward() { return pressBackward==1;} public boolean isLeft() { return pressLeft==1;} public boolean isRight() { return pressRight==1;} public boolean isUp() { return pressUp==1;} public boolean isDown() { return pressDown==1;} public void processKeyDown(Event e1,int key) { if(key==Event.UP) { if((e1.modifiers & Event.CTRL_MASK) > 0) { pressUp=1; pressForward=0;} else { pressUp=0; pressForward=1;}} else if(key==Event.DOWN) { if((e1.modifiers & Event.CTRL_MASK) > 0) { pressDown=1; pressBackward=0;} else { pressDown=0; pressBackward=1;}} else if(key==Event.LEFT) pressLeft=1; else if(key==Event.RIGHT) pressRight=1; if((e1.modifiers & Event.CTRL_MASK) > 0) pressCtrl=1; prepareUpdate();} public void processKeyUp(Event et,int key) { if(!((et.modifiers & Event.CTRL_MASK) > 0)) pressCtrl=0; if(key==Event.UP) pressUp=0; else if(key==Event.DOWN) pressDown=0; else if(key==Event.LEFT) pressLeft=0; else if(key==Event.RIGHT) pressRight=0; if(pressCtrl==0) { pressUp=0; pressDown=0; pressForward=0; pressBackward=0;} if(pressUp==0) { pressUp=0; pressForward=0;} if(pressDown==0) { pressDown=0; pressBackward=0;} if(pressLeft==0) pressLeft=0; if(pressRight==0) pressRight=0; prepareUpdate();} public void drop() { pressForward=0; pressUp=0; pressDown=0; pressLeft=0; pressRight=0; pressBackward=0;} public String toString() { return "Presska [forward="+pressForward+", backward="+pressBackward+", left="+pressLeft+", right="+pressRight+", up="+pressUp+", down="+pressDown+"]";}}